## v1.1.2 - Ritual-First Landing Page üîÆ
**Release Date:** December 31, 2025
**Status:** Production Ready

### Overview

Complete redesign of the landing page from a navigation hub into an initiation ritual. The homepage now features a stacked deck of three tarot cards that users can draw from, creating a focused, intentional experience that honors the mystical nature of tarot.

### ‚ú® New Features

#### **3-Card Ritual Experience**
- **Stacked Deck**: Three cards stack on top of each other with visible edges (25px horizontal offset)
- **Cascade Animation**: Cards shuffle in with 333ms stagger timing
- **Card Flip**: 180¬∞ rotation over 777ms with proper 3D backface handling
- **Smart Spreading**: Cards stay stacked for first reveal, then spread to 2-card or 3-card layout when selecting additional cards
- **Navigation Pause**: 888ms ritual pause before navigating to detail pages

#### **Time-Based Invocations**
Dynamic greeting messages based on time of day:
- **Morning** (5am-12pm): "What wisdom does today hold?"
- **Afternoon** (12pm-5pm): "What insight calls to you now?"
- **Evening** (5pm-9pm): "What does the sunset reveal?"
- **Night** (9pm-5am): "What speaks in the stillness?"

#### **Talk Dock System**
Compact dock below each revealed card showing the primary mapped TED talk:
- **Collapsed State**: Red play button, truncated title, chevron indicator
- **Expanded State**: Rolls up on hover/tap to reveal:
  - "TED Talk" label in TED Red (#EB0028) with Helvetica typeface
  - Full talk title (wrapped)
  - Speaker name and duration
- **Mobile Behavior**: First tap expands, second tap navigates; swipe up/down gestures supported
- **Translucency**: Backdrop blur effect with semi-transparent gradients
- **Seamless Integration**: Negative margin overlaps card bottom for visual flow

#### **Atmospheric Effects**
- **Sparkle Background**: Multi-layered sparkle system with platform-specific behaviors
- **Purple Glow**: All sparkles have violet box-shadow (`rgba(139, 92, 246)`)
- **Gradient Overlay**: Subtle radial gradient for depth

#### **TED Branding**
- "TarotTED" logo with "TED" in bold red (#EB0028) Helvetica
- Consistent branding added to card and talk detail page headers

### üé® Design Philosophy

**Before (v1.0.x):**
- Navigation hub with buttons and choices
- Users had to decide where to go
- Search bar prominent
- Feature explanation accordion

**After (v1.1.2):**
- Single focused action: draw a card
- Immediate engagement without decisions
- Search hidden by default
- Minimal instruction text

### üìÅ New Files Created

```
components/ritual/
‚îú‚îÄ‚îÄ RitualCard.tsx          # Card with flip animation & talk dock
‚îú‚îÄ‚îÄ CardCascade.tsx         # Orchestrates 3-card layout
‚îú‚îÄ‚îÄ Invocation.tsx          # Time-based greeting
‚îú‚îÄ‚îÄ SparkleBackground.tsx   # Atmospheric effect
‚îî‚îÄ‚îÄ index.ts                # Clean exports

app/api/ritual-cards/
‚îî‚îÄ‚îÄ route.ts                # Returns 3 random cards with primary talks

public/
‚îî‚îÄ‚îÄ deck-back.webp          # Tarot card back image
```

### üîß Modified Files

| File | Changes |
|------|---------|
| `app/page.tsx` | Complete rewrite with ritual components |
| `app/globals.css` | Added ritual animations (flip, cascade, sparkle, pulse) |
| `app/cards/[slug]/page.tsx` | Added TarotTED branding to header |
| `app/talks/[slug]/page.tsx` | Added TarotTED branding to header |
| `devnotes/NEXT-STEPS_landingpageritual.md` | Updated with implementation status |

### üéØ CTA Text Updates

| State | Message |
|-------|---------|
| Initial (no cards revealed) | "Choose a card to start" |
| After first reveal | "Click the card or talk for detailed information" |
| All cards revealed | Redraw button appears |

### üìä Animation Timing

| Animation | Duration | Purpose |
|-----------|----------|---------|
| Card cascade | 333ms stagger | Stacked entrance |
| Card flip | 777ms | Reveal animation |
| Navigation pause | 600ms | Quick fade before route change |
| Sparkle breathe | 8000ms | Subtle atmosphere |
| Sparkle float | 12000ms | Gentle movement |
| Sparkle travel (mobile) | 12-28s | Cross-screen journey |
| Sparkle pulse (desktop) | 3-7s | Individual rhythm |
| Invocation pulse | 3000ms | Text attention |
| Layout spread | 600ms | Card repositioning |

### ‚ú® Sparkle System (Detailed)

The sparkle background has three distinct layers with platform-specific behaviors:

#### **Layer 1: Breathing Sparkles (All Platforms)**
| Property | Value | Notes |
|----------|-------|-------|
| Count | 20 | Static, generated once |
| Size | 2-5px | Random per sparkle |
| Position | Random % | Spread across viewport |
| Opacity | 0.1-0.25 | Subtle visibility |
| Animation | `sparkle-breathe` | 8s breathe + 12s float |

#### **Layer 2: Traveling Sparkles (Mobile Only)**
| Property | Value | Notes |
|----------|-------|-------|
| Count | 16 | Doubled from original 8 |
| Size | 2-5px | Random per sparkle |
| Duration | 12-28 seconds | Varied travel time |
| Stagger | 1s between starts | Prevents clustering |
| Animation | `sparkle-travel` | Fade in ‚Üí travel ‚Üí fade out |
| Path | Random start ‚Üí random end | Uses CSS custom properties |

```css
/* Travel animation uses CSS variables for dynamic paths */
--start-x: random viewport X
--start-y: random viewport Y
--end-x: random viewport X
--end-y: random viewport Y
```

#### **Layer 3: Mouse Sparkles (Desktop Only)**
| Property | Value | Notes |
|----------|-------|-------|
| Max count | 50 | Older sparkles pruned |
| Spawn trigger | 30px mouse movement | Prevents spam |
| Spawn rate | 1-2 per trigger | Random |
| Spawn radius | ¬±30px from cursor | Scattered placement |
| Size | 2-6px | Random per sparkle |

**Lifecycle:**
1. **Spawn** ‚Üí Full opacity, `life: 1`
2. **Fade** ‚Üí Life decreases by 0.03 every 50ms
3. **Settle** ‚Üí At `life: 0.33`, sparkle becomes permanent
4. **Pulse** ‚Üí Settled sparkles pulse between 3%-33% opacity
5. **Drift** ‚Üí All sparkles slowly drift (0.3px/tick random direction)

**Individual Rhythm:**
| Property | Range | Purpose |
|----------|-------|---------|
| `pulseSpeed` | 3000-7000ms | Unique cycle duration |
| `pulseOffset` | 0-2œÄ radians | Desynchronized pulsing |
| `driftX/Y` | ¬±0.15 | Slow random travel |

```css
/* Dynamic pulse animation with CSS custom properties */
@keyframes sparkle-settle-dynamic {
  0%, 100% { opacity: var(--pulse-min, 0.03); }
  50% { opacity: var(--pulse-max, 0.33); }
}
```

### üÉè Card Layout & Transitions (Detailed)

#### **Layout Modes**

| Mode | Container Width | Card Positions | Trigger |
|------|-----------------|----------------|---------|
| `stacked` | 280px | 0px, 25px, 50px (overlapping) | Initial state |
| `spread-2` | 720px | 10px, 250px, 490px | 2nd card revealed OR non-first card first |
| `spread-3` | 720px | 10px, 250px, 490px | 3rd card revealed |

**Note:** `spread-2` and `spread-3` use identical positioning to prevent layout shift when revealing the third card.

#### **Card Position Calculation**
```typescript
// Stacked mode (280px container)
left: `${index * 25}px`  // Cards offset 25px horizontally

// Spread modes (720px container)
left: `${index * 240 + 10}px`  // 10px, 250px, 490px
```

#### **Z-Index Management**
| Mode | Formula | Result (cards 0,1,2) |
|------|---------|---------------------|
| Stacked | `3 - index` | 3, 2, 1 (card 0 on top) |
| Spread | `index` | 0, 1, 2 (proper layering) |

#### **Mobile Scroll-to-Center Behavior**

On mobile (<768px), the revealed card is automatically scrolled to center:

| Scenario | Scrolls? | Delay | Reason |
|----------|----------|-------|--------|
| Reveal card 0 while stacked | No | - | Already centered in 280px container |
| Reveal card 1 or 2 while stacked | Yes | 650ms | Wait for spread transition (600ms) |
| Reveal any card while already spread | Yes | 400ms | Short delay for flip animation start |

**Scroll Calculation:**
```typescript
const cardWidth = 200;      // Mobile card width
const cardGap = 240;        // Position increment
const cardOffset = 30;      // 10px base + 20px container padding

const cardLeft = cardOffset + (index * cardGap);
const cardCenter = cardLeft + (cardWidth / 2);
const scrollLeft = cardCenter - (containerWidth / 2);
```

#### **Mobile Scroll Container**
| Property | Value | Purpose |
|----------|-------|---------|
| `overflow-x` | `auto` (mobile) / `visible` (desktop) | Horizontal scroll on mobile |
| `snap-x` | `mandatory` (mobile only) | Cards snap to positions |
| `padding-x` | `20px` (mobile) / `0` (desktop) | Edge spacing |
| `scrollbar-hide` | Yes | Hidden scrollbar |

#### **Swipe Hint**
Displayed on mobile when cards are spread:
```
‚Üê Swipe to see all cards ‚Üí
```
- Only visible on screens < 768px
- Pulses with `animate-pulse` for attention

### üîß Technical Notes

#### Card Positioning Logic
```typescript
// Stacked mode (280px centered container)
left: `${index * 25}px` // 0px, 25px, 50px

// Spread-3 mode (720px container)
left: `${index * 240 + 10}px` // 10px, 250px, 490px
```

#### Z-Index Management
- Stacked: `zIndex: 3 - index` (card 0 on top)
- Spread: `zIndex: index` (proper layering)

#### Mobile Touch Handling
- Touch start/end tracking for swipe detection
- 30px threshold for swipe up/down
- Click outside detection to close dock

### üéØ Impact

**For Users:**
- Immediate mystical experience on landing
- Clear single action (draw a card)
- Reduced cognitive load
- Mobile-optimized interactions

**For Engagement:**
- Direct path to card ‚Üí talk discovery
- No navigation decisions required
- Emotional connection through ritual framing

### üêõ Bug Fixes (Post-Release)

| File | Issue | Fix |
|------|-------|-----|
| `app/page.tsx:101` | Unclosed `<br>` tag causing JSX error | Changed to self-closing `<br />` |
| `components/ritual/CardCascade.tsx:78` | TypeScript type comparison error - comparing `layoutMode` to `'stacked'` after it was narrowed | Simplified to use `wasStacked` variable only |
| `components/ritual/RitualCard.tsx:271` | Card flip animation broken on mobile - back face disappeared immediately, leaving blank space during first half of flip | Removed opacity-based hiding; let `backfaceVisibility: hidden` handle the 3D flip naturally |
| `app/page.tsx:19` | Desktop scroll position jumping down on page refresh | Added `history.scrollRestoration = 'manual'` and `setTimeout` with `behavior: 'instant'` to override browser restoration |

**TypeScript Error Details:**
```
Type error: This comparison appears to be unintentional because
the types '"spread-2" | "spread-3"' and '"stacked"' have no overlap.
```
Root cause: Inside the `setRevealedCards` callback, TypeScript's control flow analysis had narrowed `layoutMode` after conditional logic, making the comparison redundant.

**Card Flip Animation Fix Details:**
The card back had `${isRevealed ? 'opacity-0' : 'opacity-100'}` in its className. When `onReveal()` was called, `isRevealed` became true immediately, causing the back face to disappear before the 777ms flip animation could show it rotating. The fix removes the opacity toggle and relies on CSS `backfaceVisibility: hidden` to naturally hide each face when it rotates past 90¬∞.

### ‚ú® Dynamic Invocations (Post-Release Enhancement)

The invocation message above the cards now pulls from the **journal prompts** of the drawn cards, creating the impression that the question emerges from the spread itself.

#### **Selection Logic**
Based on the ones digit of the current minute:

| Ones Digit | Source Card | Prompt Index |
|------------|-------------|--------------|
| 1 | Top (index 0) | Prompt 0 |
| 2 | Top (index 0) | Prompt 1 |
| 3 | Top (index 0) | Prompt 2 |
| 4 | Middle (index 1) | Prompt 0 |
| 5 | Middle (index 1) | Prompt 1 |
| 6 | Middle (index 1) | Prompt 2 |
| 7 | Bottom (index 2) | Prompt 0 |
| 8 | Bottom (index 2) | Prompt 1 |
| 9 | Bottom (index 2) | Prompt 2 |
| 0 | N/A | Time-of-day fallback |

#### **Implementation Flow**
```
CardCascade fetches cards with journalingPrompts
    ‚Üì
onCardsLoaded callback passes prompts[][] to page
    ‚Üì
Invocation receives prompts, selects based on minute
    ‚Üì
300ms delay, then 700ms fade-in transition
```

#### **Files Modified**
| File | Change |
|------|--------|
| `app/api/ritual-cards/route.ts` | Added `journalingPrompts` to SELECT query |
| `components/ritual/CardCascade.tsx` | Added `onCardsLoaded` callback prop, extracts/parses prompts |
| `components/ritual/Invocation.tsx` | Rewritten to accept `journalPrompts` prop, implements selection logic |
| `app/page.tsx` | Added state management, wires CardCascade ‚Üí Invocation |

#### **UX Behavior**
- Invocation area stays empty while cards load
- Once cards appear, the prompt fades in (300ms delay + 700ms transition)
- Creates subtle impression that the question comes from the cards
- Falls back to time-of-day messages if ones digit is 0 or prompts unavailable

### üîÆ Future Enhancements (Not Yet Implemented)

1. ~~**Dynamic Invocations**: Pull from card/talk language fragments~~ ‚úÖ Implemented!
2. **Sound Design**: Subtle audio cues for card flip, navigation
